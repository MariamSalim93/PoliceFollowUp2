@model SharedLayer.Models.ReceiveCaseDTO

@{
    ViewBag.Title = "استقبال حالة";
}
<head>
    <script src="~/Scripts/jquery-3.7.1.min.js"></script>
    <script src="~/Scripts/jquery.validate.min.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/Scripts/JsScript/formFieldValidation.js"></script>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/bootstrap.css" rel="stylesheet" />
    <link href="~/Content/bootstrap-grid.min.css" rel="stylesheet" />
    <link href="~/Content/CSSFiles/HomeStyle.css" rel="stylesheet" />

    <style>

        .btn.btn-Add {
            background-color: #7b7268 !important;
            color: white;
            text-align: center;
            padding: 5px 15px;
            font-weight: 600;
        }

        .btn-Add:hover {
            background-color: #e8e3dd;
            color: #7b7268;
        }

        * {
            text-align: right;
            direction: rtl
        }

        .Subtitle {
            background-color: #81715e0e;
            color: #81715e;
            padding: 15px;
            font-weight: 700;
            font-size: 15px;
        }

        .control-label {
            font-weight: 600;
        }

        .form-control {
            font-size: small;
        }

        select {
            -webkit-appearance: menulist;
            -moz-appearance: menulist;
            appearance: menulist;
        }

            select.custom-select {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                background-image: url('arrow-down-icon.png');
                background-repeat: no-repeat;
                background-position: right center;
                padding-right: 300px;
            }

        .nav-link {
            color: #81715e;
        }

        .nav-tabs .nav-item.show .nav-link, .nav-tabs .nav-link.active {
            background-color: #81715e0b;
            color: #81715e;
            font-weight: 600;
            border-top: 3px solid #81715e;
            border-radius: 0px;
        }
        /* Section Headers */
        .Subtitle {
            background: linear-gradient(to right, #bdb0a1, #f0ece9);
            color: #81715e;
            padding: 12px 20px;
            font-weight: 700;
            font-size: 15px;
            margin-bottom: 20px;
            margin-top: 15px;
            border-right: 4px solid #81715e;
            border-radius: 4px;
        }
    </style>
</head>
<div class="container-fluid mt-3">
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }


    @using (Ajax.BeginForm("AddReceiveCase", "ConvictFile",
    new AjaxOptions { HttpMethod = "POST", InsertionMode = InsertionMode.Replace }
    ))
    {

        @Html.AntiForgeryToken()

        <div class="p-3 bg-white shadow-sm" style="font-size:small">
            <h3  class="Subtitle">استقبال حالة</h3>
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <label class="control-label">نوع الحالة</label>
                        @Html.DropDownListFor(model => model.StatusType,
                         new SelectList(new[] {
                             new { Value = "", Text = "يرجى الاختيار" },
                             new { Value = "خدمة مجتمعية", Text = "خدمة مجتمعية" },
                             new { Value = "مراقبة إلكترونية", Text = "مراقبة إلكترونية" },
                         }, "Value", "Text", Model.StatusType),
                         new { @class = "form-control is-invalid", @Required = "@Required" })
                        @Html.ValidationMessageFor(model => model.StatusType, "", new { @class = "text-danger" })

                    </div>
                </div>

                <div class="col-md-4">
                    <div class="form-group">
                        <label class="control-label">الحكم أو القرار الصادر</label>
                        @Html.DropDownListFor(model => model.Decision, new SelectList(ViewBag.DecisionMaster, "DecisionName", "DecisionName"), "يرجى الاختيار", new { @Id = "Decision", @class = "form-control is-invalid", @Required = "@Required" })
                        @Html.ValidationMessageFor(model => model.Decision, "", new { @class = "text-danger" })

                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label class="control-label">جهة التنفيذ</label>
                        @Html.DropDownListFor(model => model.ImplementingAuthority, new SelectList(ViewBag.AuthorityMaster, "AuthorityName", "AuthorityName"), "يرجى الاختيار", new { @Id = "ImplementingAuthority", @class = "form-control is-invalid", @Required = "@Required" })
                        @Html.ValidationMessageFor(model => model.ImplementingAuthority, "", new { @class = "text-danger" })


                    </div>
                </div>


            </div>

            <div class="row">
                @* ← هذا الغلاف الجديد *@
                <div class="col-md-4">
                    <div class="form-group">
                        <label class="control-label">مصدر الحكم</label>
                        @Html.DropDownListFor(model => model.JudgmentSource, new SelectList(ViewBag.JudgmentSourceMaster, "JudgmentSourceName", "JudgmentSourceName"), "يرجى الاختيار", new { @Id = "JudgmentSource", @class = "form-control is-invalid", @Required = "@Required" })
                        @Html.ValidationMessageFor(model => model.JudgmentSource, "", new { @class = "text-danger" })

                    </div>
                </div>
                <div class="col-md-4 date-range">
                    <div class="form-group">
                        <label class="control-label">تاريخ بدء التنفيذ</label>
                        @Html.TextBoxFor(model => model.StartDate, "{0:yyyy-MM-dd}", new { @class = "form-control", type = "date" })
                    </div>
                </div>
                <div class="col-md-4 date-range">
                    <div class="form-group">
                        <label class="control-label">تاريخ الانتهاء</label>
                        @Html.TextBoxFor(model => model.EndDate, "{0:yyyy-MM-dd}", new { @class = "form-control", type = "date" })
                    </div>
                </div>
            </div>

            <div class="Subtitle" style="margin-bottom: 20px; text-align: right;">توضيح المعلومات والبيانات</div>
            <div style="max-width: 700px; margin-right: 0; margin-left: auto;">
                <table class="table table-bordered table-sm text-center" style="font-size: 18px;">
                    <thead class="Subtitle">
                        <tr>
                            <th style="width: 5%; font-size: 18px;">م</th>
                            <th style="width: 60%; font-size: 18px;">المعلومات التي تم توضيحها</th>
                            <th style="width: 6%; font-size: 18px;">نعم</th>
                            <th style="width: 6%; font-size: 18px;">لا</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>منطوق الحكم أو القرار الصادر من الجهة القضائية</td>
                            <td>@Html.RadioButtonFor(m => m.Info1, "نعم", new { @id = "Info1_Yes" })</td>
                            <td>@Html.RadioButtonFor(m => m.Info1, "لا", new { @id = "Info1_No" })</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>الجهة المعنية بالتنفيذ</td>
                            <td>@Html.RadioButtonFor(m => m.Info2, "نعم", new { @id = "Info2_Yes" })</td>
                            <td>@Html.RadioButtonFor(m => m.Info2, "لا", new { @id = "Info2_No" })</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>المدة القانونية بالتنفيذ</td>
                            <td>@Html.RadioButtonFor(m => m.Info3, "نعم", new { @id = "Info3_Yes" })</td>
                            <td>@Html.RadioButtonFor(m => m.Info3, "لا", new { @id = "Info3_No" })</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>الإجراءات الواجب اتباعها</td>
                            <td>@Html.RadioButtonFor(m => m.Info4, "نعم", new { @id = "Info4_Yes" })</td>
                            <td>@Html.RadioButtonFor(m => m.Info4, "لا", new { @id = "Info4_No" })</td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td>العقوبات المترتبة في حال مخالفة الأوامر والتعليمات</td>
                            <td>@Html.RadioButtonFor(m => m.Info5, "نعم", new { @id = "Info5_Yes" })</td>
                            <td>@Html.RadioButtonFor(m => m.Info5, "لا", new { @id = "Info5_No" })</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>طريقة التواصل مع جهات التنفيذ و الإشراف</td>
                            <td>@Html.RadioButtonFor(m => m.Info6, "نعم", new { @id = "Info6_Yes" })</td>
                            <td>@Html.RadioButtonFor(m => m.Info6, "لا", new { @id = "Info6_No" })</td>
                        </tr>
                        <tr id="question7">
                            <td>7</td>
                            <td>الهدف العام من تطبيق الخدمة المجتمعية</td>
                            <td>@Html.RadioButtonFor(m => m.Info7, "نعم", new { @id = "Info7_Yes" })</td>
                            <td>@Html.RadioButtonFor(m => m.Info7, "لا", new { @id = "Info7_No" })</td>
                        </tr>
                    </tbody>
                </table>
            </div>


            <div class="row mt-3" style="font-size:small; display:none">
                <input type="text" name="FileNo" value="@ViewBag.ReceiveCase.FileNo" />

                <input type="text" name="Status" value="@ViewBag.ReceiveCase.Status" class="form-control" />

                <input type="datetime-local" name="CreatedDate" value="@((ViewBag.ReceiveCase.CreatedDate as DateTime?)?.ToString("yyyy-MM-ddTHH:mm"))" class="form-control bg-body-secondary" readonly />
                <input type="text" name="CreatedBy" value="@ViewBag.ReceiveCase.CreatedBy" class="form-control bg-body-secondary" readonly />

                <input type="text" name="EditedBy" value="@ViewBag.ReceiveCase.EditedBy" class="form-control" />
                <textarea name="EditNote" class="form-control" rows="3">@ViewBag.ReceiveCase.EditNote</textarea>

                <input type="text" name="ApprovedBy" value="@ViewBag.ReceiveCase.ApprovedBy" class="form-control" />
                <textarea name="ApproveNotes" class="form-control" rows="3">@ViewBag.ReceiveCase.ApproveNotes</textarea>
                <input type="datetime-local" id="EditDate" value="" class="form-control" />
                <input type="datetime-local" id="ApproveDate" value="" class="form-control" />
            </div>

        </div>

        <div class="row">
            <div class="mt-3" style="text-align: left !important;">
                <input type="submit" class="btn btn-sm btn-Add p-2" value="حفظ" />
            </div>
        </div>



    }
</div>



<script>
    (function () {
        function setVisible($el, visible) {
            $el.toggle(visible);
            $el.find('input,select,textarea').prop('disabled', !visible);
        }

        function applyVisibility() {
            // التقط اختيار نوع الحالة (نص عربي كما في القائمة)
            var v = ($('select[name="StatusType"]').val() || '').trim();

            var isCommunity = (v === 'خدمة مجتمعية');
            var isElectronic = (v === 'مراقبة إلكترونية');

            // خدمة مجتمعية: أخفِ التاريخ، أظهر Info7
            if (isCommunity) {
                setVisible($('.date-range'), false);
                setVisible($('#question7'), true);
            }
            // مراقبة إلكترونية: أظهر التاريخ، أخفِ Info7
            else if (isElectronic) {
                setVisible($('.date-range'), true);
                setVisible($('#question7'), false);
            }
            // غير ذلك (يرجى الاختيار): أظهر الاثنين أو اختر ما يناسبك
            else {
                setVisible($('.date-range'), true);
                setVisible($('#question7'), true);
            }
        }

        // عند تغيير نوع الحالة
        $(document).on('change', 'select[name="StatusType"]', applyVisibility);

        // عند التحميل الأول (لو في قيمة بالموديل)
        $(function () { applyVisibility(); });
    })();
</script>




