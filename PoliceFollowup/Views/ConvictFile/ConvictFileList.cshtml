@model IEnumerable<SharedLayer.Models.ConvictFileDTO>
@{
    ViewBag.Title = "قائمة المحكومين";
}
<head>
    <link href="~/Content/CSSFiles/HomeStyle.css" rel="stylesheet" />
    <link href="~/Content/CSSFiles/StatusStyle.css" rel="stylesheet" />
    <style>
        * {
            text-align: right;
            direction: rtl;
        }

        body {
            background: #f5f6fa;
        }

        /* Modern Header Style - Same as Details Page */
        .page-header {
            background: linear-gradient(135deg, #81715e 0%, #ab9e8f 100%);
            padding: 30px;
            margin: 20px 5px 30px 5px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(129, 113, 94, 0.2);
            position: relative;
            overflow: hidden;
        }

            .page-header::before {
                content: '';
                position: absolute;
                top: 0;
                right: -100px;
                width: 200px;
                height: 200px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 50%;
            }

            .page-header::after {
                content: '';
                position: absolute;
                bottom: -50px;
                left: -50px;
                width: 150px;
                height: 150px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 50%;
            }

            .page-header h3 {
                color: white !important;
                margin: 0;
                font-size: 28px;
                font-weight: 600;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                position: relative;
                z-index: 1;
            }


            .page-header img {
                position: relative;
                z-index: 1;
                width: 45px;
                background: #f4f1ed;
                padding: 8px;
                border-radius: 10px;
            }

        .btn-Add {
            background: linear-gradient(135deg, #b39f87 0%, #fdfbf8 100%);
            color: #806c55;
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(129, 113, 94, 0.3);
            position: relative;
            z-index: 1;
        }

            .btn-Add:hover {
                background: linear-gradient(135deg, #6d5f50 0%, #9a8d7e 100%);
                color: white;
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(129, 113, 94, 0.4);
            }
        /* Table Styles */
        table.dataTable thead th {
            background-color: #81715e !important;
            color: #fff !important;
            border: none !important;
            padding: 12px 8px !important;
            font-weight: 600 !important;
            font-size: 13px !important;
            text-align: center !important;
        }

        table.dataTable tbody tr {
            background: #fff;
            transition: background 0.2s ease;
        }

            table.dataTable tbody tr:hover {
                background: #f8f9fa !important;
            }

        table.dataTable tbody td {
            padding: 10px 8px !important;
            font-size: 12px !important;
            vertical-align: middle !important;
        }

        .dt-buttons .btn {
            background: #81715e;
            color: white;
            border: none;
            margin-left: 5px;
            transition: all 0.3s ease;
        }

            .dt-buttons .btn:hover {
                background: #6b5f50;
            }

        .dataTables_filter input {
            border: 2px solid #e0dad1 !important;
            border-radius: 6px !important;
            padding: 6px 12px !important;
        }

            .dataTables_filter input:focus {
                border-color: #81715e !important;
                outline: none !important;
            }

        @@media print {
            @@page {
                size: A3 landscape;
                font-size: 8px;
            }

            .page-header, .dt-buttons {
                display: none !important;
            }
        }
    </style>
</head>

<div class="container-fluid mt-3">
    <!-- Modern Header -->
    <div class="row">
        <div class="col-md-12">
            <div class="page-header">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center" style="gap: 15px;">
                        <img src="~/Content/images/arrest.png" width="40" />
                        <h3 class="mb-0">قائمة المحكومين</h3>
                    </div>
                    <a href="@Url.Action("AddConvictFile", "ConvictFile")" class="btn btn-Add">
                        <i class="fa fa-plus ml-1"></i> إضافة ملف محكوم
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Table Card -->
    <div class="p-3 bg-white shadow-sm" style="border-radius: 12px;">
        <table id="TableId" class="display border-0 nowrap" style="width:100%;font-size:smaller">
            <thead>
                <tr>
                    <th>@Html.DisplayNameFor(model => model.ReportID)</th>
                    <th>@Html.DisplayNameFor(model => model.Name)</th>
                    <th>@Html.DisplayNameFor(model => model.Gender)</th>
                    <th>@Html.DisplayNameFor(model => model.Nationality)</th>
                    <th>@Html.DisplayNameFor(model => model.UnifiedNo)</th>
                    <th>@Html.DisplayNameFor(model => model.CreatedDate)</th>
                    <th>@Html.DisplayNameFor(model => model.CreatedBy)</th>
                    <th>الإجراءات</th>
                </tr>
            </thead>
        </table>
    </div>
</div>

@section scripts {
    <!-- DataTables CSS -->
    <link href="~/Content/DataTables/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="~/Content/DataTables/css/responsive.dataTables.min.css" rel="stylesheet" />
    <link href="~/css/font-awesome.min.css" rel="stylesheet" />

    <!-- jQuery -->
    <script src="~/Scripts/jquery-3.4.1.min.js"></script>

    <!-- DataTables JS -->
    <script src="~/Scripts/DataTables/jquery.dataTables.min.js"></script>
    <script src="~/Scripts/DataTables/dataTables.responsive.min.js"></script>

    <!-- Buttons JS for export functionality -->
    <script src="~/Scripts/DataTables/dataTables.buttons.min.js"></script>
    <script src="~/Scripts/DataTables/buttons.flash.min.js"></script>
    <script src="~/Scripts/jszip.min.js"></script>
    <script src="~/Scripts/pdfmake/pdfmake.min.js"></script>
    <script src="~/Scripts/pdfmake/vfs_fonts.js"></script>
    <script src="~/Scripts/DataTables/buttons.html5.min.js"></script>
    <script src="~/Scripts/DataTables/buttons.print.min.js"></script>
    <script src="~/Scripts/mainScripts/InfoSourceDT.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            var oTable;
            $.ajax({
                url: "@Url.Action("GetListOfConvictFileJson", "ConvictFile")",
                type: "GET",
                dataType: "json",
                success: function(data) {
                    oTable = $('#TableId').DataTable({
                        data: data,
                        responsive: true,
                        columns: [
                            {
                                data: "ReportID",
                                width: "8%",
                                className: "text-center"
                            },
                            {
                                data: "Name",
                                width: "18%",
                                className: "text-center"
                            },
                            {
                                data: "Gender",
                                width: "10%",
                                className: "text-center"
                            },
                            {
                                data: "Nationality",
                                width: "12%",
                                className: "text-center"
                            },
                            {
                                data: "UnifiedNo",
                                width: "12%",
                                className: "text-center"
                            },
                            {
                                data: "CreatedDate",
                                width: "12%",
                                className: "text-center",
                                render: function (data, type, row) {
                                    if (type === 'display' || type === 'filter') {
                                        var match = data.match(/\/Date\((\d+)\)\//);
                                        if (match) {
                                            var date = new Date(parseInt(match[1], 10));
                                            var formattedDate = date.getFullYear() + '-' +
                                                String(date.getMonth() + 1).padStart(2, '0') + '-' +
                                                String(date.getDate()).padStart(2, '0');
                                            return formattedDate;
                                        }
                                        return "تاريخ غير صحيح";
                                    }
                                    return data;
                                }
                            },
                            {
                                data: "CreatedBy",
                                width: "15%",
                                className: "text-center"
                            },
                            {
                                data: null,
                                width: "8%",
                                className: "text-center",
                                render: function (data, type, row) {
                                    return '<a href="/ConvictFile/ConvictFileDetails/' + row.ReportID + '" target="_blank" data-toggle="tooltip" data-placement="left" title="عرض التفاصيل" style="text-decoration:none">' +
                                           '<img src="/Content/images/checklist.png" width="26" style="transition: transform 0.2s;" onmouseover="this.style.transform=\'scale(1.1)\'" onmouseout="this.style.transform=\'scale(1)\'" /> ' +
                                           '</a>';
                                }
                            }
                        ],
                        order: [[0, 'desc']],
                        language: {
                            search: "",
                            searchPlaceholder: "🔍 البحث...",
                            sLengthMenu: "عرض _MENU_ سجل",
                            info: "عرض _START_ إلى _END_ من إجمالي _TOTAL_ سجل",
                            infoFiltered: "(تصفية من _MAX_ سجل)",
                            infoEmpty: "لا توجد سجلات",
                            zeroRecords: "لم يتم العثور على نتائج",
                            paginate: {
                                next: 'التالي',
                                previous: 'السابق'
                            }
                        },
                        dom: 'Bfrtip',
                        buttons: [
                            {
                                extend: 'copy',
                                text: '<i class="fa fa-copy"></i> نسخ',
                                className: 'btn btn-sm buttons-copy'
                            },
                            {
                                extend: 'excel',
                                text: '<i class="fa fa-file-excel-o"></i> إكسل',
                                className: 'btn btn-sm buttons-excel'
                            },
                            {
                                extend: 'print',
                                text: '<i class="fa fa-print"></i> طباعة',
                                className: 'btn btn-sm buttons-print'
                            }
                        ],
                        initComplete: function () {
                            $('.dataTables_filter input').addClass('form-control');
                            $('[data-toggle="tooltip"]').tooltip();
                        }
                    });

                    $('input', oTable.table().header()).on('keyup', function () {
                        var colIdx = $(this).closest('th').index();
                        oTable.column(colIdx).search(this.value).draw();
                    });
                },
                error: function(xhr, status, error) {
                    console.error("حدث خطأ:", status, error);
                }
            });
        });
    </script>
}